<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">var utils = require(&#39;../utils.js&#39;),
    is = utils.is;
//a set of functions for parsing, converting and intepolating color values

<span id='anm-Color'>/**
</span> * @class anm.Color
 *
 * A collection of static helpers to work with color values
 */
var Color = {};
Color.TRANSPARENT  = &#39;transparent&#39;;
// TODO: Color.RED, Color.BLUE, ....
Color.HEX_RE       = /^#?([a-fA-F\d]{2})([a-fA-F\d]{2})([a-fA-F\d]{2})$/i;
Color.HEX_SHORT_RE = /^#?([a-fA-F\d])([a-fA-F\d])([a-fA-F\d])$/i;
Color.RGB_RE       = /^rgb\s*\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)$/i;
Color.RGBA_RE      = /^rgba\s*\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*(\d*[.]?\d+)\s*\)$/i;
Color.HSL_RE       = /^hsl\s*\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*%\s*,\s*([0-9]{1,3})\s*%\s*\)$/i;
Color.HSLA_RE      = /^hsla\s*\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*%\s*,\s*([0-9]{1,3})\s*%\s*,\s*(\d*[.]?\d+)\s*\)$/i;
<span id='anm-Color-static-method-from'>/**
</span> * @static @method from
 *
 * Get {@link anm.Brush Brush}-compatible object from a color string (in any
 * CSS-compatible format, except named colors and `#rgb` instead of `#rrggbb`)
 *
 * @param {String} source
 * @return {Object} result
 * @return {Number} return.r Red value
 * @return {Number} return.g Green value
 * @return {Number} return.b Blue value
 * @return {Number} return.a Alpha value
 */
Color.from = function(test) {
    return is.str(test) ? Color.fromStr(test) : (test.r &amp;&amp; test);
};
<span id='anm-Color-static-method-fromStr'>/** @static @private @method fromStr */
</span>Color.fromStr = function(str) {
    return Color.fromHex(str) ||
        Color.fromRgb(str) ||
        Color.fromRgba(str) ||
        Color.fromHsl(str) ||
        { r: 0, g: 0, b: 0, a: 0};
};
<span id='anm-Color-static-method-fromHex'>/** @static @private @method fromHex */
</span>Color.fromHex = function(hex) {
    if (hex[0] !== &#39;#&#39;) return null;
    var result = Color.HEX_RE.exec(hex);
    if (result) {
        return {
            r: parseInt(result[1], 16),
            g: parseInt(result[2], 16),
            b: parseInt(result[3], 16),
            a: 1
        };
    }
    result = Color.HEX_SHORT_RE.exec(hex);
    return result ? {
        r: parseInt(result[1] + result[1], 16),
        g: parseInt(result[2] + result[2], 16),
        b: parseInt(result[3] + result[3], 16),
        a: 1
    } : null;
};
<span id='anm-Color-static-method-fromRgb'>/** @static @private @method fromRgb */
</span>Color.fromRgb = function(rgb) {
    if (rgb.indexOf(&#39;rgb(&#39;) !== 0) return null;
    var result = Color.RGB_RE.exec(rgb);
    return result ? {
        r: parseInt(result[1]),
        g: parseInt(result[2]),
        b: parseInt(result[3]),
        a: 1
    } : null;
};
<span id='anm-Color-static-method-fromRgba'>/** @static @private @method fromRgba */
</span>Color.fromRgba = function(rgba) {
    if (rgba.indexOf(&#39;rgba(&#39;) !== 0) return null;
    var result = Color.RGBA_RE.exec(rgba);
    return result ? {
        r: parseInt(result[1]),
        g: parseInt(result[2]),
        b: parseInt(result[3]),
        a: parseFloat(result[4])
    } : null;
};

<span id='anm-Color-static-method-fromHsl'>/** @static @private @method fromHsl */
</span>Color.fromHsl = function(hsl) {
    if (hsl.indexOf(&#39;hsl(&#39;) !== 0) return null;
    var result = Color.HSL_RE.exec(hsl);
    return result ? Color.fromHslVal(
        parseInt(result[1]) / 180 * Math.PI,
        parseInt(result[2]) / 100,
        parseInt(result[3]) / 100
    ) : null;
};
<span id='anm-Color-static-method-fromHsla'>/** @static @private @method fromHsla */
</span>Color.fromHsla = function(hsla) {
    if (hsla.indexOf(&#39;hsla(&#39;) !== 0) return null;
    var result = Color.HSLA_RE.exec(hsl);
    if (!result) return null;
    result = Color.fromHslVal(
        parseInt(result[1]) / 180 * Math.PI,
        parseInt(result[2]) / 100,
        parseInt(result[3]) / 100
    );
    result.a = parseFloat(result[4]);
    return result;
};
<span id='anm-Color-static-method-fromHslVal'>/**
</span> * @static @method fromHslVal
 *
 * Get {@link anm.Brush Brush}-compatible object from HSL values
 *
 * @param {Number} hue hue
 * @param {Number} sat saturation
 * @param {Number} light light
 * @return {Object} result
 * @return {Number} return.r Red value
 * @return {Number} return.g Green value
 * @return {Number} return.b Blue value
 * @return {Number} return.a Alpha value
 */
Color.fromHslVal = function(hue, sat, light) {
    var hueToRgb = Color.hueToRgb;
    var t2;
    if (light &lt;= 0.5) {
        t2 = light * (sat + 1);
    } else {
        t2 = light + sat - (light * sat);
    }
    var t1 = light * 2 - t2;
    return { r: hueToRgb(t1, t2, hue + 2),
        g: hueToRgb(t1, t2, hue),
        b: hueToRgb(t1, t2, hue - 2),
        a: 1 };

};
<span id='anm-Color-static-method-hueToRgb'>/** @static @private @method hueToRgb */
</span>Color.hueToRgb = function(t1, t2, hue) {
    if (hue &lt; 0) hue += 6;
    if (hue &gt;= 6) hue -= 6;
    if (hue &lt; 1) return (t2 - t1) * hue + t1;
    else if (hue &lt; 3) return t2;
    else if (hue &lt; 4) return (t2 - t1) * (4 - hue) + t1;
    else return t1;
};
<span id='anm-Color-static-method-rgb'>/**
</span> * @static @method rgb
 *
 * Convert RGB values to CSS-compatible string
 *
 * @param {Number} r Red value
 * @param {Number} g Green value
 * @param {Number} b Blue value
 * @return {String} result
 */
Color.rgb = function(r, g, b) {
    return &#39;rgb(&#39; + r + &#39;,&#39; + g + &#39;,&#39; + b + &#39;)&#39;;
};
<span id='anm-Color-static-method-rgba'>/**
</span> * @static @method rgba
 *
 * Convert RGB values to CSS-compatible string
 *
 * @param {Number} r Red value
 * @param {Number} g Green value
 * @param {Number} b Blue value
 * @param {Number} a Alpha value
 * @return {String} result
 */
Color.rgba = function(r, g, b, a) {
    return &#39;rgba(&#39; + r + &#39;,&#39; + g + &#39;,&#39; + b + &#39;,&#39; +
           (is.defined(a) ? a.toFixed(2) : 1.0) + &#39;)&#39;;
};
<span id='anm-Color-static-method-hsl'>/**
</span> * @static @method hsl
 *
 * Convert HSL values to CSS-compatible string
 *
 * @param {Number} h Hue value, in radians
 * @param {Number} s Saturation value
 * @param {Number} l Light value
 * @return {String} result
 */
Color.hsl = function(h, s, l) {
    return Color.dhsl(h / Math.PI * 180, s, l);
};
<span id='anm-Color-static-method-dhsl'>/**
</span> * @static @method dhsl
 *
 * Convert DHSL values to CSS-compatible string
 *
 * @param {Number} h Hue value, in degrees
 * @param {Number} s Saturation value
 * @param {Number} l Light value
 * @return {String} result
 */
Color.dhsl = function(dh, s, l) {
    return &#39;hsl(&#39; + Math.floor(dh) + &#39;,&#39; +
                    Math.floor(s * 100) + &#39;%,&#39; +
                    Math.floor(l * 100) + &#39;%)&#39;;
};
<span id='anm-Color-static-method-hsla'>/**
</span> * @static @method hsla
 *
 * Convert HSLA values to CSS-compatible string
 *
 * @param {Number} h Hue value, in radians
 * @param {Number} s Saturation value
 * @param {Number} l Light value
 * @param {Number} a Alpha value
 * @return {String} result
 */
Color.hsla = function(h, s, l, a) {
    return Color.dhsla(h / Math.PI * 180, s, l, a);
};
<span id='anm-Color-static-method-dhsla'>/**
</span> * @static @method dhsla
 *
 * Convert DHSLA values to CSS-compatible string
 *
 * @param {Number} h Hue value, in radians
 * @param {Number} s Saturation value
 * @param {Number} l Light value
 * @param {Number} a Alpha value
 * @return {String} result
 */
Color.dhsla = function(dh, s, l, a) {
    return &#39;hsla(&#39;+ Math.floor(dh) + &#39;,&#39; +
                    Math.floor(s * 100) + &#39;%,&#39; +
                    Math.floor(l * 100) + &#39;%,&#39; +
                    (is.defined(a) ? a.toFixed(2) : 1.0) + &#39;)&#39;;
};
<span id='anm-Color-static-method-adapt'>/** @static @private @method adapt */
</span>Color.adapt = function(color) {
    if (!color) return null;
    if (is.str(color)) return color;
    // &quot;r&quot; is reserved for gradients, so we test for &quot;g&quot; to be sure
    if (is.defined(color.g)) return Color.toRgbaStr(color);
    if (is.defined(color.h)) return Color.toHslaStr(color);
};
<span id='anm-Color-static-method-toRgbaStr'>/** @static @private @method toRgbaStr */
</span>Color.toRgbaStr = function(color) {
    return Color.rgba(color.r,
                      color.g,
                      color.b,
                      color.a);
};
<span id='anm-Color-static-method-toHslaStr'>/** @static @private @method toHslaStr */
</span>Color.toHslaStr = function(color) {
    return Color.hsla(color.h,
                      color.s,
                      color.l,
                      color.a);
};
<span id='anm-Color-static-method-interpolate'>/**
</span> * @static @method interpolate
 *
 * Find a color located at a given distance between two given colors
 *
 * See {@link anm.Brush#static-method-interpolate Brush.interpolate()}
 *
 * @param {anm.Color} c1 starting value of a color
 * @param {anm.Color} c2 final value of a color
 * @param {Number} t distance between colors, `0..1`
 * @return {anm.Color} color located at a given distance between two given colors
 */
Color.interpolate = function(c1, c2, t) {
    return {
        r: Math.round(utils.interpolateFloat(c1.r, c2.r, t)),
        g: Math.round(utils.interpolateFloat(c1.g, c2.g, t)),
        b: Math.round(utils.interpolateFloat(c1.b, c2.b, t)),
        a: utils.interpolateFloat(c1.a, c2.a, t)
    };
};

module.exports = Color;
</pre>
</body>
</html>
