<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">// Bands
// -----------------------------------------------------------------------------

var Bands = {};

// recalculate all global bands down to the very
// child, starting from given element
Bands.recalc = function(elm, in_band) {
    in_band = in_band || (elm.parent ? elm.parent.gband : [0, 0]);
    elm.gband = [ in_band[0] + elm.lband[0],
                  in_band[0] + elm.lband[1] ];
    elm.each(function(child) {
        Bands.recalc(child, elm.gband);
    });
};

// makes inner band coords relative to outer space
Bands.wrap = function(outer, inner) {
    if (!outer) return inner;
    return [ outer[0] + inner[0],
             ((outer[0] + inner[1]) &lt;= outer[1]) ?
              (outer[0] + inner[1]) : outer[1]
            ];
};

// makes band maximum wide to fit both bands
Bands.expand = function(from, to) {
    if (!from) return to;
    return [ ((to[0] &lt; from[0]) ?
               to[0] : from[0]),
             ((to[1] &gt; from[1]) ?
              to[1] : from[1])
           ];
};

// finds minimum intersection of the bands
Bands.reduce = function(from, to) {
    if (!from) return to;
    return [ ((to[0] &gt; from[0]) ?
              to[0] : from[0]),
             ((to[1] &lt; from[1]) ?
              to[1] : from[1])
           ];
};

module.exports = Bands;
</pre>
</body>
</html>
