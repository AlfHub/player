<!DOCTYPE html>

<html>
<head>
  <title>builder.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="anm.html">
                anm.js
              </a>
            
              
              <a class="source" href="builder.html">
                builder.js
              </a>
            
              
              <a class="source" href="player.html">
                player.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>builder.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="comment">/*
 * Copyright (c) 2011-2013 by Animatron.
 * All rights are reserved.
 *
 * Animatron player is licensed under the MIT License, see LICENSE.
 *
 * @VERSION
 */</span>

(((<span class="keyword">typeof</span> __anm !== <span class="string">'undefined'</span>) &amp;&amp; __anm.registerUsingAnm) || <span class="keyword">function</span>() {
    <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'Player namespace is not initialized'</span>);
})(<span class="string">'Builder'</span>, <span class="keyword">function</span>(anm) {

<span class="keyword">var</span> Path = anm.Path;
<span class="keyword">var</span> Element = anm.Element;
<span class="keyword">var</span> Text = anm.Text;
<span class="keyword">var</span> Image = anm.Image;
<span class="keyword">var</span> Sheet = anm.Sheet;

<span class="keyword">var</span> C = anm.C;

<span class="keyword">var</span> MSeg = anm.MSeg, LSeg = anm.LSeg, CSeg = anm.CSeg;

<span class="keyword">var</span> is = __anm.is;

<span class="keyword">var</span> modCollisions = C.MOD_COLLISIONS; <span class="comment">// if defined, module exists</span>

<span class="keyword">var</span> __b_cache = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>var deprecated = function(instead) { return new Error(instead ? &#39;Deprecated, use &#39; + instead + &#39;instead.&#39; : &#39;Derpacated.&#39;) };</p>
<p>=============================================================================</p>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>=== BUILDER =================================================================</p>
<blockquote>
<p>Builder % ()</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="keyword">function</span> <span class="title">Builder</span><span class="params">(obj)</span> {</span>
    <span class="keyword">if</span> (!obj) {
        <span class="keyword">this</span>.n = <span class="string">''</span>;
        <span class="keyword">this</span>.v = <span class="keyword">new</span> Element();
    } <span class="keyword">else</span> <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Builder) {
        <span class="keyword">this</span>.n = obj.n;
        <span class="keyword">this</span>.v = obj.v.deepClone();
        <span class="keyword">this</span>.x = <span class="keyword">this</span>.v.xdata;
        <span class="keyword">this</span>.f = <span class="keyword">this</span>._extractFill(obj.f);
        <span class="keyword">this</span>.s = <span class="keyword">this</span>._extractStroke(obj.s);
        <span class="keyword">this</span>.v.__b$ = <span class="keyword">this</span>;
        <span class="keyword">return</span>; <span class="comment">// all done</span>
    } <span class="keyword">else</span> <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Element) {
        <span class="keyword">this</span>.n = obj.name;
        <span class="keyword">this</span>.v = obj;
    } <span class="keyword">else</span> <span class="keyword">if</span> (is.str(obj)) {
        <span class="keyword">this</span>.n = obj;
        <span class="keyword">this</span>.v = <span class="keyword">new</span> Element();
        <span class="keyword">this</span>.v.name = <span class="keyword">this</span>.n;
    }
    <span class="keyword">this</span>.x = <span class="keyword">this</span>.v.xdata;
    <span class="keyword">this</span>.bs = <span class="keyword">this</span>.v.bstate;
    <span class="keyword">this</span>.v.__b$ = <span class="keyword">this</span>;
    <span class="keyword">this</span>.f = <span class="keyword">this</span>._extractFill(Builder.DEFAULT_FILL);
    <span class="keyword">this</span>.s = <span class="keyword">this</span>._extractStroke(Builder.DEFAULT_STROKE);
    <span class="keyword">this</span>.d = <span class="literal">undefined</span>; <span class="comment">// duration</span>
    <span class="keyword">this</span>.a = <span class="literal">undefined</span>; <span class="comment">// animator</span>
}
Builder._$ = <span class="keyword">function</span>(obj) {
    <span class="keyword">if</span> (obj &amp;&amp; (obj <span class="keyword">instanceof</span> Element)) {
        <span class="keyword">if</span> (__b_cache[obj.id]) <span class="keyword">return</span> __b_cache[obj.id];
        <span class="keyword">return</span> (__b_cache[obj.id] = <span class="keyword">new</span> Builder(obj));
    }
    <span class="keyword">var</span> inst = <span class="keyword">new</span> Builder(obj);
    __b_cache[inst.v.id] = inst;
    <span class="keyword">return</span> inst;
}

Builder.__path = <span class="keyword">function</span>(val, join) {
    <span class="keyword">return</span> is.arr(val)
           ? Builder.path(val)
           : ((val <span class="keyword">instanceof</span> Path) ? val
              : Path.parse(val, join))
}</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Builder.DEFAULT_STROKE = Path.BASE_STROKE;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.DEFAULT_STROKE = Path.EMPTY_STROKE;
Builder.DEFAULT_FILL = Path.BASE_FILL;
Builder.DEFAULT_CAP = Path.DEFAULT_CAP;
Builder.DEFAULT_JOIN = Path.DEFAULT_JOIN;
Builder.DEFAULT_FFACE = Text.DEFAULT_FFACE;
Builder.DEFAULT_FSIZE = Text.DEFAULT_FSIZE;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <ul>
<li>BUILD *</li>
</ul>
<blockquote>
<p>builder.build % () =&gt; Element</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.build = <span class="keyword">function</span>() {
    <span class="keyword">return</span> <span class="keyword">this</span>.v;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <ul>
<li>STRUCTURE *</li>
</ul>
<blockquote>
<p>builder.add % (what: Element | Builder) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.add = <span class="keyword">function</span>(what) {
    <span class="keyword">if</span> (what <span class="keyword">instanceof</span> Element) {
        <span class="keyword">this</span>.v.add(what);
    } <span class="keyword">else</span> <span class="keyword">if</span> (what <span class="keyword">instanceof</span> Builder) {
        <span class="keyword">this</span>.v.add(what.v);
    }
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <blockquote>
<p>builder.remove % (what: Element | Builder) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.remove = <span class="keyword">function</span>(what) {
    <span class="keyword">if</span> (what <span class="keyword">instanceof</span> Element) {
        <span class="keyword">this</span>.v.remove(what);
    } <span class="keyword">else</span> <span class="keyword">if</span> (what <span class="keyword">instanceof</span> Builder) {
        <span class="keyword">this</span>.v.remove(what.v);
    } <span class="keyword">else</span> <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'Don\'t know what to remove'</span>);
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <ul>
<li>SHAPES *</li>
</ul>
<p>TODO: move shapes to B.P.rect/... ?</p>
<blockquote>
<p>builder.path % (pt: Array[2,Integer],
                  path: String | Path) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.path = <span class="keyword">function</span>(pt, path) {
    <span class="keyword">this</span>.move(pt || [<span class="number">0</span>, <span class="number">0</span>]);
    <span class="keyword">var</span> path = Builder.__path(path, <span class="keyword">this</span>.x.path);
    <span class="keyword">this</span>.x.path = path;
    <span class="keyword">if</span> (!path.fill) { path.fill = <span class="keyword">this</span>.f; }
    <span class="keyword">else</span> { <span class="keyword">this</span>.f = path.fill; }
    <span class="keyword">if</span> (!path.stroke) { path.stroke = <span class="keyword">this</span>.s; }
    <span class="keyword">else</span> { <span class="keyword">this</span>.s = path.stroke; }
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <blockquote>
<p>builder.npath % (pt: Array[2,Integer],
                  path: String | Path) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.npath = <span class="keyword">function</span>(pt, path) {
    <span class="keyword">var</span> _npath = Builder.__path(path, <span class="keyword">this</span>.x.path).clone();
    _npath.normalize();
    <span class="keyword">this</span>.path(pt, _npath);
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <blockquote>
<p>builder.rect % (pt: Array[2,Integer],
                  rect: Array[2,Integer] | Integer) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.rect = <span class="keyword">function</span>(pt, rect) {
    <span class="keyword">var</span> rect = is.arr(rect) ? rect : [ rect, rect ];
    <span class="keyword">var</span> w = rect[<span class="number">0</span>], h = rect[<span class="number">1</span>];
    <span class="keyword">this</span>.path(pt, [[<span class="number">0</span>, <span class="number">0</span>], [w, <span class="number">0</span>],
                   [w, h], [<span class="number">0</span>, h],
                   [<span class="number">0</span>, <span class="number">0</span>]]);
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <blockquote>
<p>builder.circle % (pt: Array[2,Integer],
                   radius: Float) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.circle = <span class="keyword">function</span>(pt, radius) {
    <span class="keyword">this</span>.move(pt || [<span class="number">0</span>, <span class="number">0</span>]);
    <span class="keyword">var</span> diameter = radius + radius,
        dimen = [ diameter, diameter ];
    <span class="keyword">this</span>.v._dimen = dimen;
    <span class="keyword">var</span> pvt = <span class="keyword">this</span>.pvt(),
        center = [ pvt[<span class="number">0</span>] * diameter,
                   pvt[<span class="number">1</span>] * diameter ];
    <span class="keyword">this</span>.paint(<span class="keyword">function</span>(ctx) {
            <span class="keyword">var</span> b = <span class="keyword">this</span>.$.__b$;
            <span class="keyword">var</span> pvt = b.pvt();
            Path.applyF(ctx, b.f, b.s, <span class="literal">null</span><span class="comment">/*strokes are not supported for the moment*/</span>,
                <span class="keyword">function</span>() {
                    ctx.arc(center[<span class="number">0</span>], center[<span class="number">1</span>],
                            radius, <span class="number">0</span>, Math.PI*<span class="number">2</span>, <span class="literal">true</span>);
                });
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>FIXME: move this line to the collisions module itself
FIXME: should be auto-updatable</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (modCollisions) <span class="keyword">this</span>.v.reactAs(
            Builder.arcPath(center[<span class="number">0</span>], center[<span class="number">1</span>], radius, <span class="number">0</span>, <span class="number">1</span>, <span class="number">12</span>));
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>TODO:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="comment">/*Builder.prototype.oval = function(pt, hradius, vradius) {
}*/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <blockquote>
<p>builder.image % (pt: Array[2,Integer],
                   src: String) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.image = <span class="keyword">function</span>(pt, src, callback) {
    <span class="keyword">this</span>.move(pt || [<span class="number">0</span>, <span class="number">0</span>]);
    <span class="keyword">if</span> (src) {
        <span class="keyword">var</span> b = <span class="keyword">this</span>;
        <span class="keyword">this</span>.x.sheet =
           <span class="keyword">new</span> Image(src, callback);
    }
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <blockquote>
<p>builder.text % (pt: Array[2,Integer],
                  lines: String | Array | Text,
                  [size: Float],
                  [font: String | Array]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.text = <span class="keyword">function</span>(pt, lines, size, font) {
    <span class="keyword">this</span>.move(pt || [<span class="number">0</span>, <span class="number">0</span>]);
    <span class="keyword">var</span> text = lines <span class="keyword">instanceof</span> Text ? lines
                     : <span class="keyword">new</span> Text(lines, Builder.font(font, size));
    <span class="keyword">this</span>.x.text = text;
    <span class="keyword">if</span> (!text.stroke) { text.stroke = <span class="keyword">this</span>.s; }
    <span class="keyword">else</span> { <span class="keyword">this</span>.s = text.stroke; }
    <span class="keyword">if</span> (!text.fill) { text.fill = <span class="keyword">this</span>.f; }
    <span class="keyword">else</span> { <span class="keyword">this</span>.f = text.fill; }
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <blockquote>
<p>builder.sprite % (pt: Array[2,Integer],
                    src: String | Sheet,
                    [tile_spec: Array[2,Integer] | Function],
                    [callback: Function(Image)]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.sprite = <span class="keyword">function</span>(pt, src, tile_spec, callback) {
    <span class="keyword">this</span>.move(pt || [<span class="number">0</span>, <span class="number">0</span>]);
    <span class="keyword">var</span> animator;
    <span class="keyword">if</span> (is.str(src)) {
        animator = Builder.sheet(src, tile_spec, callback)(<span class="keyword">this</span>.v);
    } <span class="keyword">else</span> <span class="keyword">if</span> (is.fun(src)) {
        animator = src(<span class="keyword">this</span>.v);
    } <span class="keyword">else</span> <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'Incorrect source for sprite'</span>);
    <span class="keyword">this</span>.x.sheet = animator.sheet;
    <span class="keyword">this</span>.a = animator;
    <span class="keyword">return</span> <span class="keyword">this</span>;
}
Builder.prototype.<span class="keyword">switch</span> = <span class="keyword">function</span>(frames, fps, repeat) {
    <span class="keyword">if</span> (!<span class="keyword">this</span>.a) <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'This builder has no animator, so no switch possible'</span>);
    <span class="keyword">this</span>.a.<span class="keyword">switch</span>(frames, fps, repeat);
    <span class="keyword">return</span> <span class="keyword">this</span>;
}
Builder.prototype.animate = <span class="keyword">function</span>(t, frames, fps, repeat) {
    <span class="keyword">if</span> (!<span class="keyword">this</span>.a) <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'This builder has no animator, so no animation possible'</span>);
    <span class="keyword">this</span>.a.animate(t, frames, fps, repeat);
    <span class="keyword">return</span> <span class="keyword">this</span>;
}
Builder.prototype.run = <span class="keyword">function</span>(t) {
    <span class="keyword">if</span> (!<span class="keyword">this</span>.a) <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'This builder has no animator, so no running possible'</span>);
    <span class="keyword">this</span>.a.run(t);
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <ul>
<li>FILL &amp; STROKE *</li>
</ul>
<blockquote>
<p>builder.fill % (color: String) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.fill = <span class="keyword">function</span>(fval) {
    <span class="keyword">this</span>.f = ( is.str(fval)
               ? { color: fval }
               : (fval.r ? { <span class="string">'rgrad'</span>: fval } : { <span class="string">'lgrad'</span>: fval }));
    <span class="keyword">if</span> (<span class="keyword">this</span>.x.path) <span class="keyword">this</span>.x.path.fill = <span class="keyword">this</span>.f;
    <span class="keyword">if</span> (<span class="keyword">this</span>.x.text) <span class="keyword">this</span>.x.text.fill = <span class="keyword">this</span>.f;
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <blockquote>
<p>builder.stroke % (color: String[, width: Float,
                    cap: String, join: String]) // C.PC_*
                 =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.stroke = <span class="keyword">function</span>(sval, width, cap, join) {
    <span class="keyword">this</span>.s = (is.str(sval) ? {
        <span class="string">'width'</span>: (width != <span class="literal">null</span>) ? width
                 : Builder.DEFAULT_STROKE.width,
        <span class="string">'color'</span>: sval,
        <span class="string">'cap'</span>: cap || Builder.DEFAULT_CAP,
        <span class="string">'join'</span>: join || Builder.DEFAULT_JOIN
    } : (sval.r ? { <span class="string">'rgrad'</span>: sval } : { <span class="string">'lgrad'</span>: sval }));
    <span class="keyword">if</span> (<span class="keyword">this</span>.x.path) <span class="keyword">this</span>.x.path.stroke = <span class="keyword">this</span>.s;
    <span class="keyword">if</span> (<span class="keyword">this</span>.x.text) <span class="keyword">this</span>.x.text.stroke = <span class="keyword">this</span>.s;
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <blockquote>
<p>builder.nofill % () =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.nofill = <span class="keyword">function</span>() {
    <span class="keyword">this</span>.f = <span class="literal">null</span>;
    <span class="keyword">if</span> (<span class="keyword">this</span>.x.path) <span class="keyword">this</span>.x.path.fill = <span class="literal">null</span>;
    <span class="keyword">if</span> (<span class="keyword">this</span>.x.text) <span class="keyword">this</span>.x.text.fill = <span class="literal">null</span>;
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <blockquote>
<p>builder.nostroke % () =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.nostroke = <span class="keyword">function</span>() {
    <span class="keyword">this</span>.s = <span class="literal">null</span>;
    <span class="keyword">if</span> (<span class="keyword">this</span>.x.path) <span class="keyword">this</span>.x.path.stroke = <span class="literal">null</span>;
    <span class="keyword">if</span> (<span class="keyword">this</span>.x.text) <span class="keyword">this</span>.x.text.stroke = <span class="literal">null</span>;
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <ul>
<li>STATIC MODIFICATION *</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>C.R_TL = [ <span class="number">0.0</span>, <span class="number">0.0</span> ]; C.R_TC = [ <span class="number">0.5</span>, <span class="number">0.0</span> ]; C.R_TR = [ <span class="number">1.0</span>, <span class="number">0.0</span> ];
C.R_ML = [ <span class="number">0.0</span>, <span class="number">0.5</span> ]; C.R_MC = [ <span class="number">0.5</span>, <span class="number">0.5</span> ]; C.R_MR = [ <span class="number">1.0</span>, <span class="number">0.5</span> ];
C.R_BL = [ <span class="number">0.0</span>, <span class="number">1.0</span> ]; C.R_BC = [ <span class="number">0.5</span>, <span class="number">1.0</span> ]; C.R_BR = [ <span class="number">1.0</span>, <span class="number">1.0</span> ];</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <blockquote>
<p>builder.reg % (pt: Array[2,Float] | side: C.R_*) =&gt; Builder | Array[2,Float]</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.reg = <span class="keyword">function</span>(pt) {
    <span class="keyword">var</span> x = <span class="keyword">this</span>.x;
    <span class="keyword">if</span> (!pt) <span class="keyword">return</span> x.reg;
    x.reg = pt || x.reg;
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <blockquote>
<p>builder.pvt % (pt: Array[2,Float] | side: C.R_*) =&gt; Builder | Array[2,Float]</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.pvt = <span class="keyword">function</span>(pt) {
    <span class="keyword">var</span> x = <span class="keyword">this</span>.x;
    <span class="keyword">if</span> (!pt) <span class="keyword">return</span> x.pvt;
    x.pvt = pt;
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <blockquote>
<p>builder.pvtpt % (pt: Array[2,Float]) =&gt; Builder | Array[2,Float]</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.pvtpt = <span class="keyword">function</span>(pt) {
    <span class="keyword">var</span> x = <span class="keyword">this</span>.x;
    <span class="keyword">if</span> (pt) {
        <span class="keyword">var</span> dimen = <span class="keyword">this</span>.v.dimen();
        x.pvt = [ dimen[<span class="number">0</span>] ? (pt[<span class="number">0</span>] / dimen[<span class="number">0</span>]) : <span class="number">0</span>,
                  dimen[<span class="number">1</span>] ? (pt[<span class="number">1</span>] / dimen[<span class="number">1</span>]) : <span class="number">0</span> ];
        <span class="keyword">return</span> <span class="keyword">this</span>;
    } <span class="keyword">else</span> {
        <span class="keyword">var</span> pvt = x.pvt;
        <span class="keyword">var</span> dimen = <span class="keyword">this</span>.v.dimen();
        <span class="keyword">return</span> [ dimen[<span class="number">0</span>] * pvt[<span class="number">0</span>],
                 dimen[<span class="number">1</span>] * pvt[<span class="number">1</span>] ];
    }
}</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <blockquote>
<p>builder.init % (val: Object) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.init = <span class="keyword">function</span>(state) {
    <span class="keyword">this</span>.v.bstate = state;
    <span class="keyword">this</span>.bs = state;
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <blockquote>
<p>builder.move % (pt: Array[2,Integer]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.move = <span class="keyword">function</span>(pt) {
    <span class="keyword">this</span>.bs.x = pt[<span class="number">0</span>];
    <span class="keyword">this</span>.bs.y = pt[<span class="number">1</span>];
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <blockquote>
<p>builder.pos % ([pt: Array[2,Integer]]) =&gt; Array[2] | Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.pos = <span class="keyword">function</span>(pt) {
    <span class="keyword">return</span> pt ? <span class="keyword">this</span>.move(pt) : [ <span class="keyword">this</span>.bs.x, <span class="keyword">this</span>.bs.y ];
}</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <blockquote>
<p>builder.dpos % () =&gt; Array[2]</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.dpos = <span class="keyword">function</span>() {
    <span class="keyword">return</span> <span class="keyword">this</span>.v.getPosition();
}</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <blockquote>
<p>builder.apos % () =&gt; Array[2]</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.apos = <span class="keyword">function</span>() {
    <span class="keyword">var</span> pos = <span class="keyword">this</span>.dpos(),
        off = <span class="keyword">this</span>.offset();
    <span class="keyword">return</span> [ off[<span class="number">0</span>] + pos[<span class="number">0</span>], off[<span class="number">1</span>] + pos[<span class="number">1</span>] ];
}</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <blockquote>
<p>builder.offset % () =&gt; Array[2]</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.offset = <span class="keyword">function</span>() {
    <span class="keyword">return</span> <span class="keyword">this</span>.v.offset();
}</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <blockquote>
<p>builder.zoom % (val: Float) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.zoom = <span class="keyword">function</span>(val) {
    <span class="keyword">if</span> (<span class="keyword">this</span>.x.path) {
        <span class="keyword">this</span>.x.path.zoom(val);</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>this.path(this.x.path); // will normalize it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    } <span class="keyword">else</span> {
        <span class="keyword">this</span>.size([ val, val ]);
    }
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <blockquote>
<p>builder.size % (val: Array[2,Float]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.size = <span class="keyword">function</span>(val) {
    <span class="keyword">this</span>.bs.sx = val[<span class="number">0</span>];
    <span class="keyword">this</span>.bs.sy = val[<span class="number">1</span>];
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <blockquote>
<p>builder.resize % (val: Array[2,Float]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.resize = Builder.prototype.size;</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <blockquote>
<p>builder.proportions % (val: Array[2,Float]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.proportions = Builder.prototype.size;</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <blockquote>
<p>builder.skew % (val: Array[2,Integer]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.skew = <span class="keyword">function</span>(val) {
    <span class="keyword">this</span>.bs.hx = val[<span class="number">0</span>];
    <span class="keyword">this</span>.bs.hy = val[<span class="number">1</span>];
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <blockquote>
<p>builder.angle % (val: Float) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.angle = <span class="keyword">function</span>(val) {
    <span class="keyword">this</span>.bs.angle = val;
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <blockquote>
<p>builder.slope % (val: Float) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.slope = Builder.prototype.angle;</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <blockquote>
<p>builder.turn % (val: Float) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.turn = Builder.prototype.angle;</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <blockquote>
<p>builder.opacity % (val: Float) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.opacity = <span class="keyword">function</span>(val) {
    <span class="keyword">this</span>.bs.alpha = val;
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <blockquote>
<p>builder.bounds % (val: Array[4,Float]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.bounds = <span class="keyword">function</span>(bounds) {
    <span class="keyword">if</span> (!bounds.length === <span class="number">4</span>) <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'Incorrect bounds'</span>);
    <span class="keyword">this</span>.x.__bounds = bounds;
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <ul>
<li>BANDS &amp; DURATION *</li>
</ul>
<blockquote>
<p>builder.band % (band: Array[2,Float]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.band = <span class="keyword">function</span>(band) {
    <span class="keyword">this</span>.v.setBand(band);
    <span class="keyword">return</span> <span class="keyword">this</span>;
}
<span class="comment">/* FIXME: duration specifies scene duration, but probably user expects it to set element's duration, find
   some another nice name to set scene duration and make this method set element's duration */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <blockquote>
<p>builder.duration % (val: Float) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.duration = <span class="keyword">function</span>(value) {
    <span class="keyword">if</span> (<span class="keyword">this</span>.v.parent) <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'Please set duration only to the root element'</span>);
    <span class="keyword">this</span>.d = value;</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>if (this.v.scene) this.v.scene.setDuration(value);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <ul>
<li>TWEENS *</li>
</ul>
<blockquote>
<p>builder.tween % (type: String, // (C.T<em>*)
                   band: Array[2,Float],
                   data: Any,
                   [easing: String (Easing.T</em>*) | Object | Function]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.tween = <span class="keyword">function</span>(type, band, data, easing) {
    <span class="keyword">this</span>.v.addTween({
        type: type,
        time: band,
        data: data,
        easing: easing
    });
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <blockquote>
<p>builder.tween % (type: String, // (C.T<em>*)
                   band: Array[2,Float],
                   data: Any,
                   [easing: String (Easing.T</em>*) | Object | Function]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.rtween = <span class="keyword">function</span>(type, band, data, easing) {</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>TODO: add relative tweens for all versions (+ include them in tests)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">this</span>.v.addTween({
        type: type,
        time: band,
        data: data,
        easing: easing,
        relative: <span class="literal">true</span>
    });
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>FIXME: add rtrans, rscale, ralpha and s.o.</p>
<blockquote>
<p>builder.untween % (tween: Function) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.untween = Builder.prototype.unmodify;</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <blockquote>
<p>builder.rotate % (band: Array[2,Float],
                    angles: Array[2,Float],
                    [easing: String]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.rotate = <span class="keyword">function</span>(band, angles, easing) {
    <span class="keyword">return</span> <span class="keyword">this</span>.tween(C.T_ROTATE, band, angles, easing);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <blockquote>
<p>builder.rotateP % (band: Array[2,Float],
                     [easing: String]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.rotateP = <span class="keyword">function</span>(band, easing) {</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>FIXME: take band from translate tween, if it is not defined</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">return</span> <span class="keyword">this</span>.tween(C.T_ROT_TO_PATH, band, <span class="literal">null</span>, easing);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <blockquote>
<p>builder.scale % (band: Array[2,Float],
                   values: Array[2,Array[2, Float]],
                   [easing: String]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.scale = <span class="keyword">function</span>(band, values, easing) {
    <span class="keyword">return</span> <span class="keyword">this</span>.tween(C.T_SCALE, band, values, easing);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <blockquote>
<p>builder.xscale % (band: Array[2,Float],
                    values: Array[2, Float],
                    [easing: String]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.xscale = <span class="keyword">function</span>(band, values, easing) {
    <span class="keyword">return</span> <span class="keyword">this</span>.scale(band, [ [ values[<span class="number">0</span>], values[<span class="number">0</span>] ],
                              [ values[<span class="number">1</span>], values[<span class="number">1</span>] ] ], easing);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <blockquote>
<p>builder.shear % (band: Array[2,Float],
                   values: Array[2,Array[2, Float]],
                   [easing: String]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.shear = <span class="keyword">function</span>(band, values, easing) {
    <span class="keyword">return</span> <span class="keyword">this</span>.tween(C.T_SHEAR, band, values, easing);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <blockquote>
<p>builder.xshear % (band: Array[2,Float],
                    values: Array[2, Float],
                    [easing: String]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.xshear = <span class="keyword">function</span>(band, values, easing) {
    <span class="keyword">return</span> <span class="keyword">this</span>.shear(band, [ [ values[<span class="number">0</span>], values[<span class="number">0</span>] ],
                              [ values[<span class="number">1</span>], values[<span class="number">1</span>] ] ], easing);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <blockquote>
<p>builder.trans % (band: Array[2,Float],
                   points: Array[2,Array[2, Float]],
                   [easing: String]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.trans = <span class="keyword">function</span>(band, points, easing) {
    <span class="keyword">return</span> <span class="keyword">this</span>.transP(band, [[points[<span class="number">0</span>][<span class="number">0</span>],points[<span class="number">0</span>][<span class="number">1</span>]],
                              [points[<span class="number">1</span>][<span class="number">0</span>],points[<span class="number">1</span>][<span class="number">1</span>]]], easing);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <blockquote>
<p>builder.transP % (band: Array[2,Float],
                    path: String | Path,
                    [easing: String]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.transP = <span class="keyword">function</span>(band, path, easing) {
    <span class="keyword">return</span> <span class="keyword">this</span>.tween(C.T_TRANSLATE, band, Builder.__path(path, <span class="keyword">this</span>.x.path), easing);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <blockquote>
<p>builder.alpha % (band: Array[2,Float],
                   values: Array[2,Float],
                   [easing: String]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.alpha = <span class="keyword">function</span>(band, values, easing) {
    <span class="keyword">return</span> <span class="keyword">this</span>.tween(C.T_ALPHA, band, values, easing);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <ul>
<li>REPEAT MODES *</li>
</ul>
<blockquote>
<p>builder.mode % (mode: String[, nrep: Float]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.mode = <span class="keyword">function</span>(mode, nrep) {
    <span class="keyword">this</span>.x.mode = mode;
    <span class="keyword">if</span> (<span class="keyword">typeof</span> nrep !== <span class="string">'undefined'</span>) <span class="keyword">this</span>.x.nrep = nrep;
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <blockquote>
<p>builder.once % () =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.once = <span class="keyword">function</span>() {
    <span class="keyword">return</span> <span class="keyword">this</span>.mode(C.R_ONCE);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <blockquote>
<p>builder.stay % () =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.stay = <span class="keyword">function</span>() {
    <span class="keyword">return</span> <span class="keyword">this</span>.mode(C.R_STAY);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <blockquote>
<p>builder.loop % () =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.loop = <span class="keyword">function</span>(val) {
    <span class="keyword">return</span> <span class="keyword">this</span>.mode(C.R_LOOP, val);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <blockquote>
<p>builder.repeat % () =&gt; Builder
alias for loop</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.repeat = <span class="keyword">function</span>(val) {
    <span class="keyword">return</span> <span class="keyword">this</span>.mode(C.R_LOOP, val);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <blockquote>
<p>builder.bounce % () =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.bounce = <span class="keyword">function</span>(val) {
    <span class="keyword">return</span> <span class="keyword">this</span>.mode(C.R_BOUNCE, val);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <ul>
<li>MODIFIERS &amp; PAINTERS *</li>
</ul>
<blockquote>
<p>builder.modify % ([band: Array[2, Float],]
                    modifier: Function(time: Float,
                                       data: Any),
                    [data: Any, easing: Function(time),
                                priority: Integer]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.modify = <span class="keyword">function</span>(band, modifier, data, easing, priority) {
    <span class="keyword">if</span> (is.arr(band) || is.num(band)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>NB: easing and data are currently &quot;swapped&quot; in <code>modify</code> method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.v.addModifier({ time: band,
                             easing: easing,
                             data: data,
                             priority: priority }, modifier);
    } <span class="keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>match actual arguments, if band was omitted</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        priority = easing;
        easing = data;
        data = modifier;
        modifier = band;</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>NB: easing and data are currently &quot;swapped&quot; in <code>modify</code> method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.v.addModifier({ easing: easing,
                             data: data,
                             priority: priority }, modifier);
    }
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <blockquote>
<p>builder.rmodify % ([band: Array[2, Float],]
                     modifier: Function(time: Float,
                                        data: Any),
                     [data: Any, easing: Function(time),
                                 priority: Integer]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.rmodify = <span class="keyword">function</span>(band, modifier, data, easing, priority) {
    <span class="keyword">if</span> (is.arr(band) || is.num(band)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>NB: easing and data are currently &quot;swapped&quot; in <code>modify</code> method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.v.addModifier({ time: band,
                             easing: easing,
                             data: data,
                             relative: <span class="literal">true</span>,
                             priority: priority }, modifier);
    } <span class="keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>match actual arguments, if band was omitted</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        priority = easing;
        easing = data;
        data = modifier;
        modifier = band;</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>NB: easing and data are currently &quot;swapped&quot; in <code>modify</code> method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.v.addModifier({ easing: easing,
                             data: data,
                             relative: <span class="literal">true</span>,
                             priority: priority }, modifier);
    }
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <blockquote>
<p>builder.paint % (painter: Function(ctx: Context,
                                     data: Any),
                   [data: Any, priority: Integer]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.paint = <span class="keyword">function</span>(func, data, priority) {
    <span class="keyword">this</span>.v.addPainter(func, data, priority);
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <blockquote>
<p>builder.at % (t: time, modifier: Function(time: Float,
                                            data: Any),
                [data: Any, priority: Integer]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.at = <span class="keyword">function</span>(t, func, data, priority) {
    <span class="keyword">return</span> <span class="keyword">this</span>.modify(t, func, data, priority);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <blockquote>
<p>builder.rat % (t: time, modifier: Function(time: Float,
                                             data: Any),
                 [data: Any, priority: Integer]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.rat = <span class="keyword">function</span>(t, func, data, priority) {
    <span class="keyword">return</span> <span class="keyword">this</span>.rmodify(t, func, data, priority);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <blockquote>
<p>builder.unmodify % (modifier: Function) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.unmodify = <span class="keyword">function</span>(modifier) {
    <span class="keyword">this</span>.v.removeModifier(modifier);
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <blockquote>
<p>builder.unpaint % (painter: Function) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.unpaint = <span class="keyword">function</span>(painter) {
    <span class="keyword">this</span>.v.removePainter(painter);
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <ul>
<li>TIME-SWITCH *</li>
</ul>
<blockquote>
<p>builder.key % (name: String, value: Float) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.key = <span class="keyword">function</span>(name, value) {</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>TODO: ensure value is in band?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">this</span>.x.keys[name] = value;
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <blockquote>
<p>builder.time % (f: Function(t: Float)) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.time = <span class="keyword">function</span>(f) {
    <span class="keyword">this</span>.x.tf = f;
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <blockquote>
<p>builder.tease % (ease: Function(t: Float)) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.tease = <span class="keyword">function</span>(ease) {
    <span class="keyword">if</span> (!ease) <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'Ease function not defined'</span>);
    <span class="keyword">var</span> duration = <span class="keyword">this</span>.x.duration();
    <span class="keyword">this</span>.time(<span class="keyword">function</span>(t) {
        <span class="keyword">return</span> ease(t / duration);
    });
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <ul>
<li>EVENTS *</li>
</ul>
<blockquote>
<p>builder.on % (type: String, handler: Function(evt: Event, t: Float)) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.on = <span class="keyword">function</span>(type, handler) {
    <span class="keyword">this</span>.v.m_on(type, handler);
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <blockquote>
<p>builder.off % (handler: Function) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.off = Builder.prototype.unmodify;</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <blockquote>
<p>builder.unhandle % (handler: Function) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.unhandle = Builder.prototype.unmodify;</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <blockquote>
<p>builder.onstart % (handler: Function(t: Float)) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.onstart = <span class="keyword">function</span>(handler) {
    <span class="keyword">this</span>.v.on(C.X_START, handler);
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <blockquote>
<p>builder.onbirth % (handler: Function(t: Float)) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.onbirth = Builder.prototype.onstart;</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <blockquote>
<p>builder.onborn % (handler: Function(t: Float)) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.onborn = Builder.prototype.onstart;</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <blockquote>
<p>builder.onstop % (handler: Function(t: Float)) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.onstop = <span class="keyword">function</span>(handler) {
    <span class="keyword">this</span>.v.on(C.X_STOP, handler);
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <blockquote>
<p>builder.ondeath % (handler: Function(t: Float)) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.ondeath = Builder.prototype.onstart;</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <blockquote>
<p>builder.ondie % (handler: Function(t: Float)) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.ondie = Builder.prototype.onstart;</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <blockquote>
<p>builder.whenPlayer % (event: C.S_*, handler: Function(player: Player)) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.whenPlayer = <span class="keyword">function</span>(event, handler) {
    <span class="keyword">this</span>.v.handlePlayerEvent(event, handler);
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <ul>
<li>TAKE &amp; USE *</li>
</ul>
<blockquote>
<p>builder.take % (b: Builder) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.take = <span class="keyword">function</span>(b) {
    <span class="keyword">this</span>.n = b.n;</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>xdata contents points to the same objects
as source&#39;s xdata do</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">this</span>.v = b.v.clone();
    <span class="keyword">this</span>.x = <span class="keyword">this</span>.v.xdata;
    <span class="keyword">this</span>.bs = <span class="keyword">this</span>.v.bstate;

    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <blockquote>
<p>builder.copy % (b: Builder) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.use = <span class="keyword">function</span>(b) {
    <span class="keyword">this</span>.n = b.n;</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>xdata takes the clones of the objects
source&#39;s xdata points do</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">this</span>.v = b.v.deepClone();
    <span class="keyword">this</span>.x = <span class="keyword">this</span>.v.xdata;
    <span class="keyword">this</span>.bs = <span class="keyword">this</span>.v.bstate;

    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <ul>
<li>ENABLE &amp; DISABLE *</li>
</ul>
<blockquote>
<p>builder.disable % () =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.disable = <span class="keyword">function</span>() {
    <span class="keyword">this</span>.v.disabled = <span class="literal">true</span>;
    <span class="keyword">this</span>.v.travelChildren(<span class="keyword">function</span>(elm) { elm.disabled = <span class="literal">true</span>; });
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <blockquote>
<p>builder.enable % () =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.enable = <span class="keyword">function</span>() {
    <span class="keyword">this</span>.v.disabled = <span class="literal">false</span>;
    <span class="keyword">this</span>.v.travelChildren(<span class="keyword">function</span>(elm) { elm.disabled = <span class="literal">false</span>; });
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <ul>
<li>ITERATIONS *</li>
</ul>
<blockquote>
<p>builder.each % (visitor: Function(elm: Element)) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.each = <span class="keyword">function</span>(func) {
    <span class="keyword">this</span>.v.visitChildren(func);
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <blockquote>
<p>builder.deach % (visitor: Function(elm: Element)) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.deach = <span class="keyword">function</span>(func) {
    <span class="keyword">this</span>.v.travelChildren(func);
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <blockquote>
<p>builder.iter % (visitor: Function(elm: Element),
                  [onremove: Function(elm: Element)]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.iter = <span class="keyword">function</span>(func, rfunc) {
    <span class="keyword">this</span>.v.iterateChildren(func, rfunc);
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <blockquote>
<p>builder.diter % (visitor: Function(elm: Element),
                   [onremove: Function(elm: Element)]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.diter = <span class="keyword">function</span>(func, rfunc) {
    <span class="keyword">this</span>.v.deepIterateChildren(func, rfunc);
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <ul>
<li>DETACH &amp; CLEAR *</li>
</ul>
<blockquote>
<p>builder.detach % () =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.detach = <span class="keyword">function</span>() {
    <span class="keyword">this</span>.v.detach();
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <blockquote>
<p>builder.clear % () =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.clear = <span class="keyword">function</span>() {
    <span class="keyword">this</span>.v.clear();
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <ul>
<li>DATA *</li>
</ul>
<blockquote>
<p>builder.data % ([val: value]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.data = <span class="keyword">function</span>(value) {
    <span class="keyword">if</span> (<span class="keyword">typeof</span> value !== <span class="string">'undefined'</span>) {
        <span class="keyword">this</span>.v.data(value)
        <span class="keyword">return</span> <span class="keyword">this</span>;
    }
    <span class="keyword">return</span> <span class="keyword">this</span>.v.data();
}</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <ul>
<li>COMPOSITING *</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.acomp = <span class="keyword">function</span>(value) {
    <span class="keyword">this</span>.x.acomp = value;
    <span class="keyword">return</span> <span class="keyword">this</span>;
}

<span class="comment">/*if (modCollisions) { // IF Collisions Module enabled</pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <blockquote>
<p>builder.local % (pt: Array[2, Float]) =&gt; Array[2, Float]</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Builder.prototype.local = <span class="keyword">function</span>(pt, t) {
        <span class="keyword">return</span> <span class="keyword">this</span>.v.local(pt, t);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <blockquote>
<p>builder.global % (pt: Array[2, Float]) =&gt; Array[2, Float]</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Builder.prototype.global = <span class="keyword">function</span>(pt, t) {
        <span class="keyword">return</span> <span class="keyword">this</span>.v.global(pt, t);
    }
    Builder.prototype.bounds = <span class="keyword">function</span>(t) {
        <span class="keyword">return</span> <span class="keyword">this</span>.v.bounds(t);
    }
    Builder.prototype.bounds = <span class="keyword">function</span>(t) {
        <span class="keyword">return</span> <span class="keyword">this</span>.v.bounds(t);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>TODO: bounds, dbounds, contains, dcontains,
      collides, dcollides, intersects, dintersects,
      offset, reactAs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>} <span class="comment">// end IF modCollisions*/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <ul>
<li>MASKS *</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype.mask = <span class="keyword">function</span>(mask) {
    <span class="keyword">if</span> (mask <span class="keyword">instanceof</span> Element) {
        <span class="keyword">this</span>.v.setMask(mask);
    } <span class="keyword">else</span> <span class="keyword">if</span> (mask <span class="keyword">instanceof</span> Builder) {
        <span class="keyword">this</span>.v.setMask(mask.v);
    }
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <ul>
<li>PRIVATE *</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.prototype._extractStroke = <span class="keyword">function</span>(def_) {
    <span class="keyword">if</span> (<span class="keyword">this</span>.x.path) <span class="keyword">return</span> <span class="keyword">this</span>.x.path.stroke || def_;
    <span class="keyword">if</span> (<span class="keyword">this</span>.x.text) <span class="keyword">return</span> <span class="keyword">this</span>.x.text.stroke || def_;
    <span class="keyword">return</span> def_;
}
Builder.prototype._extractFill = <span class="keyword">function</span>(def_) {
    <span class="keyword">if</span> (<span class="keyword">this</span>.x.path) <span class="keyword">return</span> <span class="keyword">this</span>.x.path.fill || def_;
    <span class="keyword">if</span> (<span class="keyword">this</span>.x.text) <span class="keyword">return</span> <span class="keyword">this</span>.x.text.fill || def_;
    <span class="keyword">return</span> def_;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <ul>
<li>HELPERS *</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.rgb = <span class="keyword">function</span>(r, g, b, a) {
    <span class="keyword">return</span> <span class="string">"rgba("</span> + Math.floor(r) + <span class="string">","</span> +
                     Math.floor(g) + <span class="string">","</span> +
                     Math.floor(b) + <span class="string">","</span> +
                     ((<span class="keyword">typeof</span> a !== <span class="string">'undefined'</span>)
                            ? a : <span class="number">1</span>) + <span class="string">")"</span>;
}
Builder.frgb = <span class="keyword">function</span>(r, g, b, a) {
    <span class="keyword">return</span> B.rgb(r*<span class="number">255</span>,g*<span class="number">255</span>,b*<span class="number">255</span>,a);
}
Builder.hsv = <span class="keyword">function</span>(h, s, v, a) {
    <span class="keyword">return</span> B.fhsv(h/<span class="number">360</span>,s,v,a);
}
Builder.fhsv = <span class="keyword">function</span>(h, s, v, a) {
    <span class="keyword">var</span> c = v * s;
    <span class="keyword">var</span> h1 = h * <span class="number">6</span>; <span class="comment">// h * 360 / 60</span>
    <span class="keyword">var</span> x = c * (<span class="number">1</span> - Math.abs((h1 % <span class="number">2</span>) - <span class="number">1</span>));
    <span class="keyword">var</span> m = v - c;
    <span class="keyword">var</span> rgb;

    <span class="keyword">if</span> (h1 &lt; <span class="number">1</span>) rgb = [c, x, <span class="number">0</span>];
    <span class="keyword">else</span> <span class="keyword">if</span> (h1 &lt; <span class="number">2</span>) rgb = [x, c, <span class="number">0</span>];
    <span class="keyword">else</span> <span class="keyword">if</span> (h1 &lt; <span class="number">3</span>) rgb = [<span class="number">0</span>, c, x];
    <span class="keyword">else</span> <span class="keyword">if</span> (h1 &lt; <span class="number">4</span>) rgb = [<span class="number">0</span>, x, c];
    <span class="keyword">else</span> <span class="keyword">if</span> (h1 &lt; <span class="number">5</span>) rgb = [x, <span class="number">0</span>, c];
    <span class="keyword">else</span> <span class="keyword">if</span> (h1 &lt;= <span class="number">6</span>) rgb = [c, <span class="number">0</span>, x];

    <span class="keyword">return</span> Builder.rgb(<span class="number">255</span> * (rgb[<span class="number">0</span>] + m),
                       <span class="number">255</span> * (rgb[<span class="number">1</span>] + m),
                       <span class="number">255</span> * (rgb[<span class="number">2</span>] + m), a);
}
Builder.lgrad = <span class="keyword">function</span>(dir, stops) {
    <span class="keyword">return</span> {
        dir: dir,
        stops: stops
    };
}
Builder.rgrad = <span class="keyword">function</span>(dir, rad, stops) {
    <span class="keyword">return</span> {
        dir: dir,
        r: rad,
        stops: stops
    };
}
Builder.path = <span class="keyword">function</span>(points) {
    <span class="keyword">var</span> p = <span class="keyword">new</span> Path();
    p.add(<span class="keyword">new</span> MSeg([points[<span class="number">0</span>][<span class="number">0</span>], points[<span class="number">0</span>][<span class="number">1</span>]]));
    <span class="keyword">var</span> i = <span class="number">1</span>, pl = points.length;
    <span class="keyword">for</span> (; i &lt; pl; i++) {
        <span class="keyword">var</span> pts = points[i];
        <span class="keyword">if</span> (pts.length &lt; <span class="number">3</span>) {
            p.add(<span class="keyword">new</span> LSeg([ pts[<span class="number">0</span>], pts[<span class="number">1</span>] ]));
        } <span class="keyword">else</span> {
            p.add(<span class="keyword">new</span> CSeg([ pts[<span class="number">0</span>], pts[<span class="number">1</span>],
                             pts[<span class="number">2</span>], pts[<span class="number">3</span>],
                             pts[<span class="number">4</span>], pts[<span class="number">5</span>] ]));
        }
    }
    <span class="comment">/*p.add(new MSeg([ points[pl-1][0], points[pl-1][1] ]));*/</span>
    <span class="keyword">return</span> p;
}
Builder.easing = <span class="keyword">function</span>(func, data) {
    <span class="keyword">return</span> {
        <span class="string">'f'</span>: <span class="keyword">function</span>(data) { <span class="keyword">return</span> func; },
        <span class="string">'data'</span>: data
    }
}
Builder.easingF = Builder.easing; <span class="comment">// type: C.E_FUNC</span>
Builder.easingP = <span class="keyword">function</span>(path) {
    <span class="keyword">return</span> { type: C.E_PATH, data: Builder.__path(path) };
}
Builder.easingC = <span class="keyword">function</span>(seg) {
    <span class="keyword">return</span> { type: C.E_CSEG,
        data: ((seg <span class="keyword">instanceof</span> CSeg)
               ? seg : <span class="keyword">new</span> CSeg(seg)) };
}
Builder.tween = <span class="keyword">function</span>() {</pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <p>FIXME: TODO</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>}
Builder.font = <span class="keyword">function</span>(name, size) {
    <span class="keyword">var</span> fface = name || Builder.DEFAULT_FFACE;
        fface = (is.str(fface)) ? fface : fface.join(<span class="string">','</span>);
    <span class="keyword">var</span> fsize = (size != <span class="literal">null</span>) ? size : Builder.DEFAULT_FSIZE;
    <span class="keyword">return</span> fsize + <span class="string">'px '</span> + fface;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <p>example:
return b().sprite([0, 0], &#39;./res/sprite_sample.png&#39;, [144, 59])
          .animate(0, [0, 30, 1], 10);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> __t = anm.__dev.adjust;
<span class="keyword">if</span> (!__t) <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'adjust should be defined'</span>);
<span class="function"><span class="keyword">function</span> <span class="title">_get_frame</span><span class="params">(start, t, anim)</span> {</span>
    <span class="keyword">var</span> frames = anim[<span class="number">0</span>],
        fps = anim[<span class="number">1</span>],
        step = (frames.length &gt; <span class="number">2</span>) ? frames[<span class="number">2</span>] : <span class="number">1</span>,
        repeat = (frames.length &gt; <span class="number">3</span>) ? frames[<span class="number">3</span>] : (anim[<span class="number">2</span>] || <span class="literal">false</span>),
        start_frame = frames[<span class="number">0</span>],
        end_frame = frames[<span class="number">1</span>],
        dt = __t(t - start);
    <span class="keyword">var</span> len = __t((end_frame + <span class="number">1</span>) - start_frame);
    <span class="keyword">var</span> tframe = Math.floor(dt * fps) * step;
    <span class="keyword">if</span> (tframe &lt; <span class="number">0</span>) <span class="keyword">return</span> -<span class="number">1</span>;
    <span class="keyword">if</span> (!repeat &amp;&amp; (tframe &gt;= len)) <span class="keyword">return</span> -<span class="number">1</span>;
    <span class="keyword">if</span> (repeat) { tframe = tframe % len; }
    <span class="keyword">return</span> Math.floor(start_frame + tframe);
}
<span class="function"><span class="keyword">function</span> <span class="title">_Animator</span><span class="params">(sheet, elm)</span> {</span>
    <span class="keyword">this</span>.sheet = sheet;
    <span class="keyword">this</span>.elm = elm;</pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              <p>if (!(sheet === elm.xdata.sheet)) throw new Error(&#39;Element sheet is prepared wrong way&#39;);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">this</span>.cur_anim = <span class="literal">null</span>;
    <span class="keyword">var</span> me = <span class="keyword">this</span>;
    <span class="keyword">this</span>.elm.addModifier(<span class="keyword">function</span>(t) {
        <span class="keyword">if</span> (!me.cur_anim) <span class="keyword">return</span> <span class="literal">false</span>;
        <span class="keyword">var</span> frame = _get_frame(me.start, t, me.cur_anim);
        <span class="keyword">if</span> (frame &gt;= <span class="number">0</span>) {
            sheet.cur_region = frame;
        } <span class="keyword">else</span> {
            sheet.cur_region = -<span class="number">1</span>; <span class="comment">// FIXME: use default frame</span>
            me.cur_anim = <span class="literal">null</span>;
            <span class="keyword">return</span> <span class="literal">false</span>;
        }
    });
}
_Animator.prototype.<span class="keyword">switch</span> = <span class="keyword">function</span>(frames, fps, repeat) {
    <span class="keyword">this</span>._prepared_anim = [ frames, fps, repeat ];
}
_Animator.prototype.run = <span class="keyword">function</span>(t) {
    <span class="keyword">this</span>.start = t;
    <span class="keyword">this</span>.cur_anim = <span class="keyword">this</span>._prepared_anim;
}
_Animator.prototype.animate = <span class="keyword">function</span>(t, frames, fps, repeat) {
    <span class="keyword">this</span>.<span class="keyword">switch</span>(frames, fps, repeat);
    <span class="keyword">this</span>.run(t);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <blockquote>
<p>Builder.sheet % (src: String,
                   [tile_selector: Array[2,Integer] | Function(Integer) =&gt; Array[4,Integer]],
                   [callback: Function(Image)]) =&gt; Builder</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.sheet = <span class="keyword">function</span>(src, tile_spec, callback) {
    <span class="keyword">var</span> sheet = <span class="keyword">new</span> Sheet(src, <span class="keyword">function</span>(img) {
        <span class="keyword">if</span> (is.arr(tile_spec)) {
            <span class="keyword">var</span> tdimen = tile_spec,
                sdimen = <span class="keyword">this</span>.dimen(),
                h_factor = Math.floor(sdimen[<span class="number">0</span>] / tdimen[<span class="number">0</span>]);
            <span class="keyword">this</span>.region_f = <span class="keyword">function</span>(n) { <span class="keyword">var</span> v_pos = Math.floor(n / h_factor),
                                               h_pos = n % h_factor;
                                           <span class="keyword">return</span> [ h_pos * tdimen[<span class="number">0</span>], v_pos * tdimen[<span class="number">1</span>], tdimen[<span class="number">0</span>], tdimen[<span class="number">1</span>] ] };
        } <span class="keyword">else</span> <span class="keyword">if</span> (is.fun(tile_spec)) {
            <span class="keyword">this</span>.region_f = tile_spec;
        }
        <span class="keyword">if</span> (callback) callback();
    });
    <span class="keyword">return</span> <span class="keyword">function</span>(elm) { <span class="keyword">return</span> <span class="keyword">new</span> _Animator(sheet, elm); };
}</pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p>Thanks for Nek (github.com/Nek) for this function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Builder.arcPath = <span class="keyword">function</span>(centerX, centerY, radius, startAngle, arcAngle, steps){</pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>For convenience, store the number of radians in a full circle.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">var</span> twoPI = <span class="number">2</span> * Math.PI;</pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <p>To determine the size of the angle between each point on the
arc, divide the overall angle by the total number of points.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">var</span> angleStep = arcAngle/steps;</pre></div></div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p>Determine coordinates of first point using basic circle math.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">var</span> res = [];
    <span class="keyword">var</span> xx = centerX + Math.cos(startAngle * twoPI) * radius;
    <span class="keyword">var</span> yy = centerY + Math.sin(startAngle * twoPI) * radius;</pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <p>Move to the first point.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    res.push([xx, yy]);</pre></div></div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              <p>Draw a line to each point on the arc.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">1</span>; i&lt;=steps; i++){</pre></div></div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <p>Increment the angle by &quot;angleStep&quot;.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> angle = startAngle + i * angleStep;</pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              <p>Determine next point&#39;s coordinates using basic circle math.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        xx = centerX + Math.cos(angle * twoPI) * radius;
        yy = centerY + Math.sin(angle * twoPI) * radius;</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <p>Draw a line to the next point.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        res.push([xx, yy]);
    }
    <span class="keyword">return</span> Builder.path(res);
}

<span class="keyword">var</span> prevClone = Element.prototype.clone;
Element.prototype.clone = <span class="keyword">function</span>() {
    <span class="keyword">var</span> clone = prevClone.call(<span class="keyword">this</span>);
    clone.__b$ = <span class="keyword">this</span>.__b$;
    <span class="keyword">return</span> clone;
}

<span class="keyword">return</span> Builder;

});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
